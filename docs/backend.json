{
  "entities": {
    "Article": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Article",
      "type": "object",
      "description": "Represents an article related to the Moroccan stock market.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Article entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the article."
        },
        "content": {
          "type": "string",
          "description": "Content of the article."
        },
        "publicationDate": {
          "type": "string",
          "description": "Date and time the article was published.",
          "format": "date-time"
        },
        "author": {
          "type": "string",
          "description": "Author of the article."
        },
        "sector": {
          "type": "string",
          "description": "Sector the article focuses on (e.g., banking, manufacturing)."
        },
        "masiAnalysis": {
          "type": "boolean",
          "description": "Indicates whether the article contains analysis of the MASI index."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "publicationDate",
        "author"
      ]
    },
    "Bank": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bank",
      "type": "object",
      "description": "Represents a Moroccan bank for comparison purposes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Bank entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the bank."
        },
        "checkingAccountFees": {
          "type": "number",
          "description": "Fees associated with checking accounts at the bank."
        },
        "accessibilityRating": {
          "type": "number",
          "description": "Rating of the bank's accessibility (e.g., branch locations, online services)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Brokerage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Brokerage",
      "type": "object",
      "description": "Represents a Moroccan brokerage for comparison purposes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Brokerage entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the brokerage."
        },
        "feesAndCommissions": {
          "type": "number",
          "description": "Fees and commissions charged by the brokerage."
        },
        "platformFeatures": {
          "type": "string",
          "description": "Description of the brokerage's trading platform features."
        },
        "responsivenessRating": {
          "type": "number",
          "description": "Rating of the brokerage's responsiveness to customer inquiries."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents an investment course, including secure content links.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the investment course."
        },
        "description": {
          "type": "string",
          "description": "Public description of the course content."
        },
        "price": {
          "type": "number",
          "description": "Price of the course."
        },
        "instructor": {
          "type": "string",
          "description": "Instructor of the course."
        },
        "videoUrl": {
          "type": "string",
          "description": "The secure URL to the course video (e.g., Google Drive link). This should be protected by security rules."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "price",
        "instructor"
      ]
    },
    "NewsletterSubscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "NewsletterSubscription",
      "type": "object",
      "description": "Represents a user's subscription to the weekly newsletter.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the NewsletterSubscription entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the subscriber.",
          "format": "email"
        },
        "subscriptionDate": {
          "type": "string",
          "description": "Date the user subscribed to the newsletter.",
          "format": "date-time"
        },
        "active": {
          "type": "boolean",
          "description": "Indicates whether the subscription is active."
        }
      },
      "required": [
        "id",
        "email",
        "subscriptionDate"
      ]
    },
    "CourseEnrollment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course Enrollment",
      "type": "object",
      "description": "Represents a user's enrollment in a course.",
      "properties": {
        "enrollmentDate": {
          "type": "string",
          "format": "date-time",
          "description": "The date the user enrolled in the course."
        },
        "courseId": {
          "type": "string",
          "description": "The ID of the enrolled course."
        }
      },
      "required": ["enrollmentDate", "courseId"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/articles/{articleId}",
        "definition": {
          "entityName": "Article",
          "schema": {
            "$ref": "#/backend/entities/Article"
          },
          "description": "Stores articles related to the Moroccan stock market. No specific ownership is defined, suggesting global read access and restricted write access for admins.",
          "params": [
            {
              "name": "articleId",
              "description": "Unique identifier for the article."
            }
          ]
        }
      },
      {
        "path": "/banks/{bankId}",
        "definition": {
          "entityName": "Bank",
          "schema": {
            "$ref": "#/backend/entities/Bank"
          },
          "description": "Stores information about Moroccan banks for comparison. Global read access, restricted write access.",
          "params": [
            {
              "name": "bankId",
              "description": "Unique identifier for the bank."
            }
          ]
        }
      },
      {
        "path": "/brokerages/{brokerageId}",
        "definition": {
          "entityName": "Brokerage",
          "schema": {
            "$ref": "#/backend/entities/Brokerage"
          },
          "description": "Stores information about Moroccan brokerages for comparison. Global read access, restricted write access.",
          "params": [
            {
              "name": "brokerageId",
              "description": "Unique identifier for the brokerage."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores information about investment courses, including the secure video URL. Read access is restricted to enrolled users.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/newsletter_subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "NewsletterSubscription",
          "schema": {
            "$ref": "#/backend/entities/NewsletterSubscription"
          },
          "description": "Stores user subscriptions to the newsletter. Email could be used as the document ID to ensure uniqueness.  Generally open read, restricted write.",
          "params": [
            {
              "name": "subscriptionId",
              "description": "Unique identifier for the newsletter subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/enrollments/{courseId}",
        "definition": {
          "entityName": "CourseEnrollment",
          "schema": {
            "$ref": "#/backend/entities/CourseEnrollment"
          },
          "description": "Stores a user's enrollment record for a specific course.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "courseId",
              "description": "The ID of the course."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the 'MASI Insights' application, focusing on Moroccan stock market analysis, bank and brokerage comparisons, investment courses, and a weekly newsletter. To ensure security and scalability, the structure prioritizes authorization independence and clear data segregation.  The design avoids hierarchical authorization dependencies (`get()` calls in security rules) by denormalizing relevant authorization data directly into the documents where it's needed.\n\n*   **Articles:** Stored in the `/articles` collection. No specific ownership, implying global read access with potentially restricted write access for admins.\n*   **Banks & Brokerages:** Stored in separate collections (`/banks` and `/brokerages`) for comparison purposes. Again, global read, restricted write.\n*   **Courses:** Stored in the `/courses` collection. Read access is restricted to users who have an enrollment document in `/users/{userId}/enrollments/{courseId}`.\n*   **Newsletter Subscriptions:** Stored in the `/newsletter_subscriptions` collection. Each document represents a user's subscription.  The `email` field serves as a unique identifier, and access is generally open for reading, but restricted for writing. User-specific data could also be stored under `/users/{userId}/subscriptions` to guarantee ownership and data privacy.\n\nThis structure is suitable for the application's requirements, offering simple and robust security rules.  It segregates data based on its nature (articles, banks, courses, subscriptions) to avoid mixing data with different access needs within the same collection. The use of separate collections for different entities also aligns with the DBAC principle, as role-based access control can be implemented by checking for the existence of documents in dedicated roles collections (e.g., `/roles_admin/{uid}`)."
  }
}
    